<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Monitoring Dashboard</title>

  <!-- Favicon -->
  <link rel="icon" type="image/png"
    href="https://raw.githubusercontent.com/voltraxxtechnologies-boop/my-website-assets/53933e88a81248217341a7e370001d6d63296433/LOGO1.png">

  <style>
    body{
      margin:0;
      padding:0;
      font-family:'Segoe UI',sans-serif;
      background:linear-gradient(135deg,#6A329F,#3B1C5B);
      color:white;
      overflow-x:hidden;
    }

    /* ---------- UNIFIED NAVBAR ---------- */
    .top-nav{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:18px 24px;      /* identical to other pages */
      background:rgba(26,26,26,0.35);
      position:relative;
      z-index:1000;
      height:60px;            /* fixed height like other pages */
    }

    .nav-brand{
      display:flex;
      align-items:center;
      gap:10px;
      flex-shrink:0; 
      white-space:nowrap;
    }

    .nav-logo-box{
      width:40px;
      height:40px;
      border-radius:10px;
      overflow:hidden;
      flex-shrink:0;
    }
    .nav-logo-box img{
      width:100%;
      height:100%;
      object-fit:cover;
    }
    .logo{
      font-size:26px;
      font-weight:700;
      flex-shrink:0;
    }

    .nav-buttons{
      display:flex;
      gap:20px;
      flex-shrink:1;
    }
    .nav-buttons button{
      background:transparent;
      color:#fff;
      padding:8px 14px;
      font-size:16px;
      border:none;
      border-radius:6px;
      cursor:pointer;
      transition:.25s;
      white-space:nowrap;
    }
    .nav-buttons button.active{
      background:linear-gradient(135deg,#C9A8E3,#6A329F);
      font-weight:700;
      color:#fff;
    }
    .nav-buttons button:hover{
      border:2px solid #C9A8E3;
    }

    .hamburger{
      display:none;
      flex-direction:column;
      gap:5px;
      cursor:pointer;
      flex-shrink:0;
    }
    .hamburger div{
      width:28px;
      height:3px;
      background:white;
      border-radius:2px;
    }

    @media(max-width:600px){
      .nav-buttons{display:none;}
      .hamburger{display:flex;}
    }

    /* ---------- MOBILE MENU ---------- */
    .mobile-menu{
      display:none;
      flex-direction:column;
      background:rgba(26,26,26,0.95);
      padding:12px;
      position:absolute;
      left:0;
      right:0;
      top:90px;
      z-index:6000;
    }
    .mobile-menu button{
      background:transparent;
      border:none;
      font-size:16px;
      color:white;
      padding:14px;
      text-align:left;
    }
    .mobile-menu button.active{
      color:#ffd6ff;
      font-weight:bold;
    }

    /* Everything below is unchangedâ€¦ */

    .category-block{ display:none; }

    .section-title{
      margin:18px 10px;
      font-size:20px;
      font-weight:600;
    }

    .section{
      display:flex;
      gap:16px;
      overflow-x:auto;
      padding:8px 10px 20px;
    }

    .card{
      background:rgba(255,255,255,0.12);
      backdrop-filter:blur(8px);
      padding:14px;
      border-radius:14px;
      min-width:260px;
      max-width:310px;
      box-shadow:0 6px 20px rgba(0,0,0,0.35);
      transition:.25s;
    }
    .card:hover{
      transform:translateY(-5px);
      box-shadow:0 10px 28px rgba(0,0,0,0.55);
    }

    .card-header{display:flex;justify-content:space-between;margin-bottom:6px;}
    .title{font-size:16px;font-weight:700;}
    .ids{font-size:12px;opacity:.85;}

    .main-line{display:flex;justify-content:space-between;margin-top:8px;}
    .main-label{font-size:14px;color:#ffd6ff;}
    .main-value{font-size:28px;font-weight:700;}

    .sub-line{display:flex;justify-content:space-between;margin-top:6px;}
    .sub-label{font-size:13px;opacity:.85;}
    .sub-value{font-size:16px;font-weight:600;}

    /* ---------- LOADING SCREEN ---------- */
    #loadingScreen{
      position:fixed;
      top:90px;
      left:0;
      right:0;
      bottom:0;
      background:rgba(20,20,20,0.92);
      backdrop-filter:blur(4px);
      display:flex;
      justify-content:center;
      align-items:center;
      flex-direction:column;
      z-index:5000;
      color:white;
      text-align:center;
    }

    .loader{
      width:55px;
      height:55px;
      border:5px solid #ffffff55;
      border-top-color:#C9A8E3;
      border-radius:50%;
      animation:spin .9s linear infinite;
      margin-bottom:10px;
    }
    @keyframes spin{to{transform:rotate(360deg);}}

  </style>
</head>

<body>

<!-- LOADING -->
<div id="loadingScreen">
  <div class="loader"></div>
  <p>Loading...</p>
</div>

<script>
function hideLoader(){
  const l=document.getElementById("loadingScreen");
  if(l) l.style.display="none";
}
function showNoData(){
  document.querySelector("#loadingScreen .loader").style.display="none";
  document.querySelector("#loadingScreen p").innerText="NO DATA FOUND";
}
</script>

<!-- NAV -->
<div class="top-nav">

  <div class="nav-brand">
    <div class="nav-logo-box">
      <img src="https://raw.githubusercontent.com/voltraxxtechnologies-boop/my-website-assets/53933e88a81248217341a7e370001d6d63296433/LOGO1.png">
    </div>
    <div class="logo">Voltraxx</div>
  </div>

  <div class="nav-buttons">
    <button class="active" onclick="navigate('monitoring.html',this)">Monitoring</button>
    <button onclick="navigate('analysis.html',this)">Analysis</button>
    <button onclick="navigate('history.html',this)">History</button>
    <button onclick="navigate('settings.html',this)">Settings</button>
    <button onclick="logoutUser()">Logout</button>
  </div>

  <div class="hamburger" onclick="toggleMenu()">
    <div></div><div></div><div></div>
  </div>

</div>

<!-- MOBILE MENU -->
<div id="mobileMenu" class="mobile-menu">
  <button class="active" onclick="navigate('monitoring.html',this)">Monitoring</button>
  <button onclick="navigate('analysis.html',this)">Analysis</button>
  <button onclick="navigate('history.html',this)">History</button>
  <button onclick="navigate('settings.html',this)">Settings</button>
  <button onclick="logoutUser()">Logout</button>
</div>

<!-- CONTENT -->
<div class="section-wrap">

  <div class="category-block" id="block-distance">
    <h2 class="section-title">Distance</h2>
    <div class="section" id="distance"></div>
  </div>

  <div class="category-block" id="block-flow">
    <h2 class="section-title">Flow</h2>
    <div class="section" id="flow"></div>
  </div>

  <div class="category-block" id="block-temperature">
    <h2 class="section-title">Temperature</h2>
    <div class="section" id="temperature"></div>
  </div>

  <div class="category-block" id="block-none">
    <h2 class="section-title">None</h2>
    <div class="section" id="none"></div>
  </div>

</div>

<script>

/* Navigation */
function toggleMenu(){
  const m=document.getElementById('mobileMenu');
  m.style.display=(m.style.display==='flex')?'none':'flex';
}
function navigate(page,btn){
  document.querySelectorAll('.nav-buttons button,.mobile-menu button')
    .forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  window.location.href=page;
}
function logoutUser(){
  sessionStorage.clear();
  window.location="index.html";
}

/* API */
const BASE_URL=sessionStorage.getItem("BASE_URL");
if(!BASE_URL){ alert("Session expired."); window.location="index.html"; }

/* Load data */
loadData();
setInterval(loadData,600);

function loadData(){
  fetch(`${BASE_URL}?page=monitoring`)
  .then(r=>r.json())
  .then(data=>{
    renderCategory("distance",data.distance||[]);
    renderCategory("flow",data.flow||[]);
    renderCategory("temperature",data.temperature||[]);
    renderCategory("none",data.none||[]);

    let total=0;
    ["distance","flow","temperature","none"].forEach(s=>{
      total+=document.getElementById(s).children.length;
    });

    if(total===0) showNoData();
    else hideLoader();
  })
  .catch(err=>showNoData());
}

function renderCategory(sectionID,array){
  const container=document.getElementById(sectionID);
  const block=document.getElementById(`block-${sectionID}`);
  container.innerHTML="";

  array.forEach(item=>{
    if(!isValid(item.mainData)) return;

    const card=document.createElement("div");
    card.className="card";
    card.innerHTML=`
      <div class="card-header">
        <div class="title"></div>
        <div class="ids"></div>
      </div>
      <div class="main-line"><div class="main-label"></div><div class="main-value"></div></div>
      <div class="sub-line"><div class="sub-label"></div><div class="sub-value"></div></div>
    `;
    container.appendChild(card);

    const cID=item.controllerID, sID=item.sensorID;
    const title=item.label || `Sensor C${cID}:S${sID}`;

    card.querySelector(".title").innerText=title;
    card.querySelector(".ids").innerText=`C${cID}:S${sID}`;
    card.querySelector(".main-label").innerText=item.mainLabel||"";
    card.querySelector(".main-value").innerText=`${item.mainData}${item.mainUnit||""}`;
    card.querySelector(".sub-label").innerText=item.subLabel||"";
    card.querySelector(".sub-value").innerText=
        item.subData!=null && item.subData!=="" ? `${item.subData}${item.subUnit||""}` : "";

    let col="#e69df4";
    if(item.high && item.mainData>item.high) col="#ff4d4f";
    else if(item.low && item.mainData<item.low) col="#17c964";
    card.style.borderLeft=`6px solid ${col}`;
  });

  block.style.display = container.children.length===0 ? "none" : "block";
}

function isValid(v){
  return !(v==="" || v==null || v==="-" || (typeof v==="string" && v.trim()===""));
}

</script>

</body>
</html>
